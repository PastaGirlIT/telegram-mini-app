
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Team App</title>

  <8519941082:AAFxS8VlnQ5YaoIDQjDa4l5u8VVfffgjtCM>
  <script src="https://telegram.org/js/telegram-web-app.js?v=1001"></script>

  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,Arial;background:#f5f5f5;margin:0;padding:16px}
    .card{background:#fff;border-radius:12px;padding:12px;margin:12px 0}
    h2,h3{margin:8px 0;text-align:center}
    .btn{width:100%;padding:12px;margin:8px 0;border:0;border-radius:10px;font-size:16px}
    .primary{background:#2AABEE;color:#fff}
    .secondary{background:#e6e6e6}
    .warn{background:#fb8500;color:#fff}
    .hidden{display:none}
    .status{white-space:pre-wrap;font-size:13px;opacity:.9}
    input,textarea{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #ccc;box-sizing:border-box}
  </style>
</head>

<body>
  <h2>–û—Ç—á—ë—Ç—ã</h2>

  <div id="status" class="card status">–°—Ç–∞—Ç—É—Å: –∑–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>

  <div id="roleScreen" class="card">
    <h3>–ö—Ç–æ —Ç—ã —Å–µ–≥–æ–¥–Ω—è?</h3>
    <button id="btnCook" class="btn primary">üë®‚Äçüç≥ –ü–æ–≤–∞—Ä</button>
    <button id="btnCashier" class="btn primary">üí≥ –ö–∞—Å—Å–∏—Ä</button>
  </div>

  <div id="cookMenu" class="card hidden">
    <h3>–ú–µ–Ω—é –ø–æ–≤–∞—Ä–∞</h3>
    <button id="btnPrep" class="btn secondary">üçù –ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ</button>
    <button id="btnWriteoffCook" class="btn secondary">üóë –°–ø–∏—Å–∞–Ω–∏–µ</button>
    <button id="btnBreakdown" class="btn secondary">üì¶ –†–∞–∑–±–æ—Ä</button>
    <button id="btnReset1" class="btn warn">üîÑ –°–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å</button>
  </div>

  <div id="cashierMenu" class="card hidden">
    <h3>–ú–µ–Ω—é –∫–∞—Å—Å–∏—Ä–∞</h3>
    <button id="btnCashIn" class="btn secondary">‚ûï –í–Ω–µ—Å–µ–Ω–∏–µ</button>
    <button id="btnCashOut" class="btn secondary">‚ûñ –ò–∑—ä—è—Ç–∏–µ</button>
    <button id="btnWriteoffCash" class="btn secondary">üóë –°–ø–∏—Å–∞–Ω–∏–µ</button>
    <button id="btnReset2" class="btn warn">üîÑ –°–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å</button>
  </div>

  <div id="workScreen" class="card hidden">
    <h3 id="workTitle">...</h3>
    <div id="workBody" class="status"></div>
    <button id="btnBack" class="btn secondary">–ù–∞–∑–∞–¥</button>
  </div>

  <script>
    // ----- –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä—è–º–æ –Ω–∞ —ç–∫—Ä–∞–Ω–µ -----
    const statusEl = document.getElementById("status");
    const log = (m) => { statusEl.textContent = "–°—Ç–∞—Ç—É—Å: " + m; };

    window.addEventListener("error", (e) => {
      log("JS error: " + (e.message || e.error || "unknown"));
    });

    window.addEventListener("unhandledrejection", (e) => {
      log("Promise error: " + (e.reason ? String(e.reason) : "unknown"));
    });

    // ----- UI helpers -----
    const show = (id) => document.getElementById(id).classList.remove("hidden");
    const hide = (id) => document.getElementById(id).classList.add("hidden");
    const setTitle = (t) => document.getElementById("workTitle").textContent = t;
    const setBody  = (t) => document.getElementById("workBody").textContent = t;

    let role = localStorage.getItem("role") || "";

    function goRole() {
      hide("cookMenu"); hide("cashierMenu"); hide("workScreen");
      show("roleScreen");
      log("–≤—ã–±–µ—Ä–∏ —Ä–æ–ª—å");
    }

    function goCookMenu() {
      hide("roleScreen"); hide("cashierMenu"); hide("workScreen");
      show("cookMenu");
      log("—Ä–æ–ª—å: –ø–æ–≤–∞—Ä");
    }

    function goCashierMenu() {
      hide("roleScreen"); hide("cookMenu"); hide("workScreen");
      show("cashierMenu");
      log("—Ä–æ–ª—å: –∫–∞—Å—Å–∏—Ä");
    }

    function goWork(title, text) {
      hide("roleScreen"); hide("cookMenu"); hide("cashierMenu");
      show("workScreen");
      setTitle(title);
      setBody(text);
      log("—ç–∫—Ä–∞–Ω: " + title);
    }

    function setRole(r) {
      role = r;
      localStorage.setItem("role", r);
      if (r === "–ø–æ–≤–∞—Ä") goCookMenu();
      else goCashierMenu();
    }

    function resetRole() {
      localStorage.removeItem("role");
      role = "";
      goRole();
    }

    // ----- –ù–∞–≤–µ—à–∏–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM -----
    document.addEventListener("DOMContentLoaded", () => {
      try {
        // Telegram ready ‚Äî –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –∫–ª–∏–∫–æ–≤
        if (window.Telegram && Telegram.WebApp) Telegram.WebApp.ready();

        document.getElementById("btnCook").addEventListener("click", () => setRole("–ø–æ–≤–∞—Ä"));
        document.getElementById("btnCashier").addEventListener("click", () => setRole("–∫–∞—Å—Å–∏—Ä"));

        document.getElementById("btnPrep").addEventListener("click", () => {
          goWork("–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ", "–î–∞–ª—å—à–µ –ø–æ–¥–∫–ª—é—á–∏–º –∫–Ω–æ–ø–∫–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã (prep_list) –∏ –æ—Ç–ø—Ä–∞–≤–∫—É –≤ reports.");
        });

        document.getElementById("btnWriteoffCook").addEventListener("click", () => {
          goWork("–°–ø–∏—Å–∞–Ω–∏–µ (–ø–æ–≤–∞—Ä)", "–î–∞–ª—å—à–µ –ø–æ–¥–∫–ª—é—á–∏–º –≤–≤–æ–¥: –Ω–∞–∑–≤–∞–Ω–∏–µ + –∫–æ–ª-–≤–æ + –µ–¥ + –ø—Ä–∏—á–∏–Ω–∞ ‚Üí reports.");
        });

        document.getElementById("btnBreakdown").addEventListener("click", () => {
          goWork("–†–∞–∑–±–æ—Ä", "–î–∞–ª—å—à–µ –ø–æ–¥–∫–ª—é—á–∏–º: –≤—ã–±—Ä–∞—Ç—å '—á—Ç–æ' ‚Üí –≤—ã–±—Ä–∞—Ç—å '–Ω–∞ —á—Ç–æ' –∏–∑ breakdown_map ‚Üí reports.");
        });

        document.getElementById("btnCashIn").addEventListener("click", () => {
          goWork("–í–Ω–µ—Å–µ–Ω–∏–µ", "–î–∞–ª—å—à–µ –ø–æ–¥–∫–ª—é—á–∏–º: —Ä—É–±/–∫–æ–ø + –ø—Ä–∏—á–∏–Ω–∞ ‚Üí cashier_reports.");
        });

        document.getElementById("btnCashOut").addEventListener("click", () => {
          goWork("–ò–∑—ä—è—Ç–∏–µ", "–î–∞–ª—å—à–µ –ø–æ–¥–∫–ª—é—á–∏–º: —Ä—É–±/–∫–æ–ø + –ø—Ä–∏—á–∏–Ω–∞ ‚Üí cashier_reports.");
        });

        document.getElementById("btnWriteoffCash").addEventListener("click", () => {
          goWork("–°–ø–∏—Å–∞–Ω–∏–µ (–∫–∞—Å—Å–∏—Ä)", "–î–∞–ª—å—à–µ –ø–æ–¥–∫–ª—é—á–∏–º: –Ω–∞–∑–≤–∞–Ω–∏–µ + –∫–æ–ª-–≤–æ + –µ–¥ + –ø—Ä–∏—á–∏–Ω–∞ ‚Üí reports –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ª–∏—Å—Ç.");
        });

        document.getElementById("btnReset1").addEventListener("click", resetRole);
        document.getElementById("btnReset2").addEventListener("click", resetRole);

        document.getElementById("btnBack").addEventListener("click", () => {
          if (role === "–ø–æ–≤–∞—Ä") goCookMenu();
          else if (role === "–∫–∞—Å—Å–∏—Ä") goCashierMenu();
          else goRole();
        });

        // —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω
        if (role === "–ø–æ–≤–∞—Ä") goCookMenu();
        else if (role === "–∫–∞—Å—Å–∏—Ä") goCashierMenu();
        else goRole();

        log("–≥–æ—Ç–æ–≤–æ (–∫–Ω–æ–ø–∫–∏ –¥–æ–ª–∂–Ω—ã –∫–ª–∏–∫–∞—Ç—å—Å—è)");
      } catch (err) {
        log("init error: " + String(err));
      }
    });
  </script>
</body>
</html>
